name: ğŸ”„ è‡ªåŠ¨æ›´æ–° DNS è§„åˆ™ï¼ˆchina + gfwlistï¼‰

on:
  schedule:
    - cron: '0 3 * * *'    # æ¯å¤©å‡Œæ™¨3ç‚¹è‡ªåŠ¨æ‰§è¡Œ
  workflow_dispatch:        # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  one:
    runs-on: ubuntu-latest

    steps:
      - name: âœ… ç­¾å‡ºä»£ç ä»“åº“
        uses: actions/checkout@v3
        with:
          fetch-depth: 0      # æ‹‰å–å®Œæ•´æäº¤å†å²ï¼Œä¿è¯git diffæ­£å¸¸è¿è¡Œ

      - name: ğŸ“¥ ä¸‹è½½ china.conf
        run: |
          curl -sSfL -o china.conf https://github.com/felixonmars/dnsmasq-china-list/raw/master/accelerated-domains.china.conf

      - name: ğŸ“¥ ä¸‹è½½å¹¶æ ¼å¼åŒ– gfwlist.conf.
        run: |
          curl -sSfL -o gfw_raw.txt https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/gfw.txt
          awk '{print "nameserver /"$0"/foreign"}' gfw_raw.txt > gfwlist.conf
          rm -f gfw_raw.txt

      - name: ğŸ’¾ æ£€æŸ¥è§„åˆ™æ˜¯å¦å˜æ›´å¹¶æäº¤
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com

          git add china.conf gfwlist.conf

          if git diff-index --quiet HEAD --; then
            echo "âš ï¸ è§„åˆ™æœªå˜æ›´ï¼Œæ— éœ€æäº¤"
          else
            git commit -m "ğŸ”„ è‡ªåŠ¨æ›´æ–°è§„åˆ™ $(date +'%Y-%m-%d %H:%M:%S')"
            git push
            echo "âœ… è§„åˆ™å·²æ›´æ–°å¹¶æäº¤"
          fi
